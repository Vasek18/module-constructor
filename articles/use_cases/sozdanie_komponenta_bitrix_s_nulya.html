<p>Довольно часто возникает необходимость написать собственный компонент под Битрикс. Например из-за что
	стандартные вам не подходят для конкретной задачи или же потому что вам нужен ваш собственный компонент для
	вашего модуля.
</p>
<p>Если вы не знаете как писать компоненты с нуля, то в <b>начале статьи</b> мы приведём для вас <b>ликбез</b>.
	А если у вас уже есть опыт их написания, то <b>в параграфе "Быстрая и простая разработка компонентов"</b> мы
	покажем вам <b>более быстрый и удобный способ их создания</b>, который сэкономит вам немало сил.
</p>
<h2>Компоненты Битрикса. Базовая теория</h2>
<p>В общих чертах компонент содержит:</p>
<ul>
	<li>Логику</li>
	<li>Представление</li>
	<li>Настройки</li>
</ul>
<p>Так как компонент - это цельная система по получению какой-либо информации, её обработке и выводу, а также
	возможной обработки действий пользователей и совершению других действий на странице сайта.
</p>
<h3>Файловая структура</h3>
<p>Ниже представлена структура файлов компонента в общем виде.</p>
<ul>
	<li><b>my.component/</b>
		<ul>
			<li>class.php</li>
			<li>component.php</li>
			<li>.parameters.php</li>
			<li>.description.php</li>
			<li><b>templates/</b>
				<ul>
					<li><b>.default/</b>
						<ul>
							<li>.parameters.php</li>
							<li>result_modifier.php</li>
							<li>template.php</li>
							<li>style.php</li>
							<li>script.php</li>
							<li>component_epilog.php</li>
							<li><b>lang/</b>
								<ul>
									<li><b>ru/</b>
										<ul>
											<li>.parameters.php</li>
											<li>result_modifier.php</li>
											<li>template.php</li>
											<li>style.php</li>
											<li>script.php</li>
											<li>component_epilog.php</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li><b>lang/</b>
				<ul>
					<li><b>ru/</b>
						<ul>
							<li>class.php</li>
							<li>component.php</li>
							<li>.parameters.php</li>
							<li>.description.php</li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</li>
</ul>
<h4>Подробнее про каждый файл</h4>
<p><b>component.php и/или class.php</b> отвечают за логику: сбор данных, их модификацию, обработку форм, работу
	с кешем и так далее. Могут использовать как вместе так и по отдельности. Component.php это "старая школа", в
	то время как class.php это уже ООП подход ядра D7. Выбор между подходами зависит от вас, но мы рекомендуем
	использовать только class.php, так как работа с ним легче в плане читаемости и доработок.
</p>
<p><b>.parameters.php-файлы</b> отвечают за настройки компонента. Как раз те, которые вы могли видеть в
	визуальном редакторе при работе со страницами, на которых есть компоненты. Сами настройки описываются как
	элементы специального массива <b>$arComponentParameters</b>, который имеет строго определённый формат. В
	зависимости от расположения файла в системе меняется его роль. Если файл лежит <b>в корне папки
		компонента</b>, то настройки из него будут видны всегда при подключении компонента, а если <b>в папке
		шаблона</b>, то только после выбора этого шаблона.
</p>
<p><b>.description.php</b> - это файл с общей информацией о компоненте. Хранит его название, описание, путь в
	визуальном редакторе и дополнительную информацию, наподобие сортировки и иконки. Всё это описывается в
	специальном массиве <b>$arComponentDescription</b>, который также имеет свою определённую структуру.
</p>
<p><b>Все папки, которые лежат внутри папки templates/</b> являются <b>шаблонами компонента</b>. Есть
	специальное название <b>.default</b>, которое обозначает <b>шаблон по умолчанию</b>, то есть тот шаблон,
	который подключится, если не выбран конкретный шаблон. Кстати, <b>шаблон с таким названием должен быть
		всегда.</b></p>
<h4>Подробнее про файлы шаблона</h4>
<p><b>template.php</b> - это собственно и есть представление компонента. По замыслу в нём не должно быть
	какой-либо логики, только вывод той информации, которую он должен получать уже подготовленной.
</p>
<p><b>result_modifier.php</b> - файл, который подключится до template.php. Его роль - дополнительная подготовка
	информации. Это необходимо для ситуации, когда у одного компонента есть несколько шаблонов, и какому-то из
	них нужно как-то особенно обработать полученные данные перед выводом или же получить новые. Это следует
	делать как раз в данном файле.
</p>
<p><b>component_epilog.php</b> - файл, который подключится уже после template.php, то есть уже после вывода
	информации. У него своя особенная роль, о которой будет рассказано в параграфе о кешировании.
</p>
<p><b>style.php и script.php</b> - это соответственно стили и javascript-файл шаблона. Если в папке шаблона
	будут файлы с именно такими названиями, то они подключатся автоматически.
</p>
<p>Все надписи и строчки текста должны быть вынесены из файлов в соответствующие им <b>lang-файлы</b>,
	<b>иначе</b> при загрузке они <b>могут стать нечитаемыми</b> вследствие нарушения кодировки. К тому же <b>переводы
		компонентов на другие языки</b> осуществляются через создание дополнительных папок внутри lang-папки.
</p>
<h3>Потоки информации между файлами компонента</h3>
<p>Как вы понимаете, в компоненте присутствует множество файлов. Одни отвечают за получение настроек, другие за
	сбор информации, третьи же за её вывод. Так как же эти данные передаются от файла к файлу?
</p>
<p>Есть 2 специальных массива: <b>$arParams и $arResult</b>.</p>
<p><b>Первый отвечает за настройки компонента</b>, за те, которые в описали в .parameters.php. Он содержит в себе код
	настройки и значение, которое указано в массиве подключения компонента на странице.
</p>
<p><b>$arResult хранит всю необходимую для работы информацию</b>. Он создаётся в class.php (или component.php),
	модифицируется в result_modifier.php, выводится в template.php. За всё время жизни он проходит следующий
	путь.
</p>
<ol>
	<li>class.php (или component.php)</li>
	<li>result_modifier.php</li>
	<li>template.php</li>
	<li>component_epilog.php</li>
</ol>
<h3>Кеширование в компонентах</h3>
<p>Наверняка вы слышали о довольно мощной системе кеширования в Битриксе. Она позволяет <b>свести запросы к базе
	данных практически до нуля</b>, а также не повторять всевозможные дополнительные вычисления. Поскольку вы пишете компонент
	сами, вам нужно самим позаботиться о кешировании. Мы советуем подробнее изучить метод StartResultCache. Вы будете вызывать в class.php компонента, откуда соответственно начнёт собираться кеш.
</p>
<p><b>Все файлы шаблона кешируются</b>. За исключением component_epilog.php, в этом и есть его специальное предназначение. В
	отличие от других файлов, <b>код внутри component_epilog.php будет выполняться на каждом хите</b>.
</p>
<p class="lead">Но есть способ лишний не думать о структуре файлов, структуре массивов и просто писать нужный для бизнеса код.</p>
<h2>Быстрая и простая разработка компонентов</h2>
<p>В нашем <a href="https://modules-constructor.ru/">Конструкторе модулей</a> есть специальный мастер для компонентов. Он позволяет избавиться от большей части рутинных процедур. Ниже мы расписали некоторые из них по пунктам. Только посмотрите как всё упрощается.</p>
<h3>Не нужно подготавливать файловую структуру</h3>
<p>Каждый раз, когда вы начинаете новый компонент, вы проделываете <b>множество повторяющихся из раза в раз операций</b>:</p>
<ul>
	<li>Создаёте папку компонента с нужным кодом</li>
	<li>Создаёте файл class.php по определённому шаблону</li>
	<li>Подготавливаете хотя бы минимальный .description.php</li>
	<li>Создаёте папку дефолтного шаблона</li>
	<li>Создаёте template.php шаблона по определённому шаблону</li>
</ul>
<p>И это только минимум того что нужно сделать хотя бы для начала работы над компонентом. А теперь посмотрите как произвести все эти операции в нашем сервисе.</p>
<img src="/articles_files/13/Forma_sozdaniya_komponenta.jpg"
	 alt="Форма создания компонента в конструкторе"
	 title="Форма создания компонента в конструкторе"
	 class="img-responsive"
/>
<p>И всё! <b>Просто заполнить форму</b>, где вы указываете лишь самые необходимые параметры. И уже после этого вы можете скачать готовую к работе папку компонента, где автоматически созданы и заполнены все обязательные файлы.</p>
<h3>Не нужно изучать работу с настройками</h3>
<p>Массив внутри .parameters.php имеет специальный формат. Вы помните его наизусть? А сколько типов полей существует для настроек? А вы знали, что у массива настроек компонента и массива настроек шаблона разные имена?</p>
<p>Больше не нужно об этом даже задумываться. Посмотрите как легко работать с настройками компонента в нашем сервисе.</p>
<img src="/articles_files/13/Forma_raboty_s_nastroykami_komponenta.jpg"
	 alt="Форма работы с настройками компонента"
	 title="Форма работы с настройками компонента"
	 class="img-responsive"
/>
<p>Не нужно писать ни строчки кода, думать над о формате, кавычках, вытаскивать фразы в lang. <b>Просто мышкой на форме</b> вбиваете имя и код свойства, его тип, дополнительную информацию по необходимости и на выходе <b>получаете готовый файл</b> с массивом.</p>
<p>Кстати, в мастере работы с шаблоном можно точно также просто создавать отдельные настройки для шаблона.</p>
<h3>Не нужно знать структуру .description.php</h3>
<p>Вы умеете работать со структурой компонентов в визуальном редакторе? Некоторые компоненты иногда нужно положить в корень, некоторые в папку модуля, некоторые во вложенную папку внутри другой папки. Для всех этих вариантов нужно уметь работать с массивом $arComponentDescription. Но сделать это <b>в данном сервисе проще простого</b>, взгляните на картинку ниже.</p>
<img src="/articles_files/13/Forma_nastroyki_puti_do_komponenta_v_vizualnom_redaktore.jpg"
	 alt="Форма настройки пути до компонента в визуальном редакторе"
	 title="Форма настройки пути до компонента в визуальном редакторе"
	 class="img-responsive"
/>
<h3>Не нужно вытаскивать фразы в lang-файлы вручную</h3>
<p>Вы знаете, что Битрикс поломает всю кириллицу в любом из файлов компонента при их скачивании из Маркетплейса. Поэтому мы должны вытаскивать фразы в специальные массивы внутри соответствующих lang-файлов, а в самих файлах компонента вставлять код вывода фразы. Делаеть <b>вручную это безумно муторно</b>. Также это необходимая операция при переводе компонента на другой язык.</p>
<p>Но мы <b>подготовили специальный раздел</b> для упрощения таких работ. Там вам показывается, какие из ваших файлов требуют внимание.</p>
<img src="/articles_files/13/Spisok_faylo_dlya_perevoda.jpg"
	 alt="Список файлов для перевода"
	 title="Список файлов для перевода"
	 class="img-responsive"
/>
<p>А на странице работы с конкретным файлом, вы <b>в один клик можете вытащить фразу в lang</b> или транслитерировать комментарий.</p>
<img src="/articles_files/13/Forma_vytaskivaniya_frazy_v_lang.jpg"
	 alt="Форма вытаскивания фразы в lang"
	 title="Форма вытаскивания фразы в lang"
	 class="img-responsive"
/>
<h3>Не нужно писать логику с нуля</h3>
<p>Очень часто компоненты выполняют похожие операции. Например, получение элементов или категорий инфоблока, обработка формы, показ информации об элементе. Чтобы не писать каждый раз логику с нуля, у нас есть пополняемый список готовых шаблонов для class.php.</p>
<img src="/articles_files/13/Stranica_s_shablonami_class.php.jpg"
	 alt="Страница с шаблонами class.php"
	 title="Страница с шаблонами class.php"
	 class="img-responsive"
/>
<p>Более того вы можете добавить свой шаблон.</p>
<img src="/articles_files/13/Forma_dobavleniya_svoego_shablona_class.php.jpg"
	 alt="Форма добавления своего шаблона class.php"
	 title="Форма добавления своего шаблона class.php"
	 class="img-responsive"
/>
<hr>
<p class="lead">Попробуйте создать свой компонент всего за несколько минут бесплатно и прямо сейчас. И прочувствуете всю лёгкость нового способа работы.<br>
	И, конечно же, пишите со всеми вопросами и предложениями нам. Сервис развивается специально для вас.</p>